$(info Starting Makevars -------------------------------------------)

# Platform detection and configuration
UNAME=$(shell uname -s)

# Compiler standard and flags
CXX_STD=CXX17
PKG_CPPFLAGS=-I"../inst/include" -I"libactionet/include" -DARMA_64BIT_WORD @CHOLMOD_INCLUDE@
PKG_CXXFLAGS=$(SHLIB_OPENMP_CXXFLAGS) -std=c++17

# Linker configuration - use relative path constructed at configure time
# On macOS: use -Wl,-force_load to ensure all symbols are included
# On Linux: use --whole-archive / --no-whole-archive for the same effect
ifeq ($(UNAME),Darwin)
    PKG_LIBS=-Wl,-force_load,@ACTIONET_LIB_PATH@ @CHOLMOD_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
else ifeq ($(UNAME),Linux)
    PKG_LIBS=-Wl,--whole-archive @ACTIONET_LIB_PATH@ -Wl,--no-whole-archive @CHOLMOD_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
else
    # Fallback for other platforms (BSD, etc.)
    PKG_LIBS=@ACTIONET_LIB_PATH@ @CHOLMOD_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
endif

# Parallel make using configured processor count from configure script
# Note: Only applied to R package Makefile targets, not nested CMake builds
MAKEFLAGS+=-j @NPROC@
