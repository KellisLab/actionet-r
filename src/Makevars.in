$(info Starting Makevars -------------------------------------------)

UNAME=$(shell uname -s)
ifeq ($(UNAME),Linux)
    $(info Using Linux configurations)
    NPROC=$${shell nproc}
else ifeq ($(UNAME),Darwin)
    $(info Using Mac OS configurations)
    NPROC=$(shell sysctl -n hw.logicalcpu)
endif

CXX_STD=CXX17
PKG_CPPFLAGS=-I"../inst/include" -I"libactionet/include" -DARMA_64BIT_WORD
PKG_CXXFLAGS=$(SHLIB_OPENMP_CXXFLAGS) -std=c++17

# Library paths and libraries - will be substituted by configure script
# On macOS, use -Wl,-force_load with ABSOLUTE path to ensure all symbols are included
# On Linux, use --whole-archive / --no-whole-archive
ifeq ($(UNAME),Darwin)
    PKG_LIBS=-Wl,-force_load,@ACTIONET_LIB_PATH@ @CHOLMOD_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
else
    PKG_LIBS=-Wl,--whole-archive @ACTIONET_LIB_PATH@ -Wl,--no-whole-archive @CHOLMOD_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
endif

MAKEFLAGS+=-j $${NPROC}
